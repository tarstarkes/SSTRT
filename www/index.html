<!DOCTYPE html>
<html>
<head>
	<script type="text/javascript" src="./js/jquery-3.2.1.min.js"></script>
	<script type="text/javascript" src="./js/parse.min.js"></script>
	<link type="text/css" rel="stylesheet" href="./css/index.css">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<script type="text/javascript" src="./js/jquery.json.min.js"></script>
	<link rel="icon" href="data:;base64,=">
	<script src="cordova.js"></script>
	<script src="http://debug2.build.phonegap.com/target/target-script-min.js#eb9244e8-7645-11e7-bf00-0e85bbe48bea"></script>
</head>
<body id="doc_body">
	<div id="content">
	</div>
	<table id="footer">
		<tr>
			<td id="timer" class="menu_button">TIMER</td>
			<td id="teams" class="menu_button">TEAMS</td>
			<td id="results" class="menu_button">RESULTS</td>
			<td id="imp_exp" class="menu_button">IMPORT/EXPORT</td>
		</tr>
	</table>
	<script>
		$(document).on('deviceready', function(e){
			console.log('device is ready');

			function writeFile(fileEntry, dataObj=false) {
			    // Create a FileWriter object for our FileEntry (log.txt).
			    fileEntry.createWriter(function (fileWriter) {

			        fileWriter.onwriteend = function() {
			            alert("File Written to Device!");
			        };

			        fileWriter.onerror = function (e) {
			            console.log("Failed to Write File: " + e.toString());
			        };

			        // If data object is not passed in,
			        // create a new Blob instead.
			        if (!dataObj) {
			            dataObj = new Blob([dataObj], { type: 'text/csv' });
			        }

			        fileWriter.write(dataObj);
			    });
			}

			window.requestFileSystem(LocalFileSystem.PERSISTENT, 0, function (fs) {
			   	window.file_system = fs;
		        var entry=cordova.file.dataDirectory; 
		        window.resolveLocalFileSystemURL(cordova.file.dataDirectory, function(entry){
		        	window.write_file = function write_file(filename, blob){
				        entry.getFile("newPersistentFile.txt", { create: true, exclusive: false }, function (fileEntry) {

					        // fileEntry.name == 'someFile.txt'
					        // fileEntry.fullPath == '/someFile.txt'
					        console.log(filename);
					        console.log(blob);
					        writeFile(fileEntry, blob);

					    }, function(err){
					    	console.log('file could not be created'+err);
					    });
				    };
			    },
			    function(err){
			    	alert("Could not retrieve device filesystem");
			    });
			}, function(){console.log('fs load error')});
		});
		$(document).ready(function(){
			Parse.initialize("ctdokDdZUkkDBdaKzRC5MJrx3t2hbXRQeiq2QWu4", "TitmnxPJ8jpt0WrvOsEGoZXmcgo1KAQIYCReRmWN");
			Parse.serverURL = 'https://parseapi.back4app.com';

			Parse.initialize('ctdokDdZUkkDBdaKzRC5MJrx3t2hbXRQeiq2QWu4', 'TitmnxPJ8jpt0WrvOsEGoZXmcgo1KAQIYCReRmWN', '3zf5ywzy3xeiONvk4UsYm56fRUS3zM3TzMBRjgiS');

			// var Runner = Parse.Object.extend("runner");
			// var runner = new Runner();
			// runner.set("first_name", "Nunya");
			// runner.set("last_name", "bidness");
			// runner.save(null, {
			// 	success: function(runner){
			// 		alert("NEW OBJECT CREATED! YAY!");
			// 	},
			// 	error: function(runner, error){
			// 		alert('failed to save runner object with error message: '+error.message);
			// 	}
			// });

			//start of application
			$.get( "./templates/timer.html", function( data ) {
			  $('#content').html( data );
			});
			$('#timer').addClass('pressed');

			//switch screens bottom menu
			$('#timer').on('click', function(e){
				$("#footer td").removeClass('pressed');
				$('#timer').addClass('pressed');
				$.get( "./templates/timer.html", function( data ) {
				  $('#content').html( data );
				});
			});
			$('#teams').on('click', function(e){
				$("#footer td").removeClass('pressed');
				$('#teams').addClass('pressed');
				$.get( "./templates/teams.html", function( data ) {
				  $('#content').html( data );
				});
			});
			$('#results').on('click', function(e){
				$("#footer td").removeClass('pressed');
				$('#results').addClass('pressed');
				$.get( "./templates/results.html", function( data ) {
				  $('#content').html( data );
				});
			});
			$('#imp_exp').on('click', function(e){
				$("#footer td").removeClass('pressed');
				$('#imp_exp').addClass('pressed');
				$.get( "./templates/import_export.html", function( data ) {
				  $('#content').html( data );
				});
			});

		});
		function click_feedback(e){
			$(e).css('opacity', '.5');
			window.setTimeout(function(){
				$(e).css('opacity', '1');
			}, 100);
		}

	</script>
</body>
</html>